<head>
	<style type="text/css">
		  html, body { height: 100%; margin: 0; padding: 0; }
		  #map { height: 100%; }
	</style>
	<title> Welcome to the Marauder's Map</title>
</head>

<body>
	{{> googleMap}}
</body>

<template name = "googleMap">
    <div id="map"></div>
    	<script type="text/javascript">
		function initMap() {
			  var map = new google.maps.Map(document.getElementById('map'), {
			    center: {lat: 42.359155, lng: -71.093058}, // 77 Mass Ave
			    zoom: 18
			  });
			 // var infoWindow = new google.maps.InfoWindow({map: map});

			  // Try HTML5 geolocation.
			  if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(function(position) {
					var pos = {
						lat: position.coords.latitude,
						lng: position.coords.longitude
				      	};

						//infoWindow.setPosition(pos);
						//infoWindow.setContent('You are here.');

						map.setCenter(pos);
						displayFriends(updateUser(pos), map);

				}, function() {
					handleLocationError(true, infoWindow, map.getCenter());
				});
			  } else {
			    	// Browser doesn't support Geolocation
			    	handleLocationError(false, infoWindow, map.getCenter());
			  }

		}

		function handleLocationError(browserHasGeolocation, infoWindow, pos) {
			infoWindow.setPosition(pos);
			infoWindow.setContent(browserHasGeolocation ?
		                        'Error: The Geolocation service failed.' :
		                        'Error: Your browser doesn\'t support geolocation.');
		}


		function updateUser(pos){

			//Update user location
			var Caitlin = {
				name: "Caitlin Mehl",
				loc: pos,
				pic: '/user_images/test_image.png', 
				status: 'available'
			};

			var friends = [Caitlin];
			return friends;
		}

		function displayFriends(friends, map) {

			friends.forEach(function(friend){

				var image = {
				    url: friend.pic,
					
					/* These need to be set but I'm not 100% sure how to do it yet 
				    size: new google.maps.Size(20, 32),
				    origin: new google.maps.Point(0, 0),
				    anchor: new google.maps.Point(0, 32)
				    */
				 };

				var marker = new google.maps.Marker({
				      position: friend.loc,
				      map: map,
				      icon: image,
				      //shape: shape,
				      title: friend.name,
				    });

			});
		}




	</script>
	<script async defer
	      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAmUWvkqoAwT70st_eiDUo0xcnIcUGgo9g&callback=initMap">
	</script>
</template>